<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.post">
    <resultMap id="postResult" type="postDTO">
        <result property="postId" column="postId" />
        <result property="userId" column="userId" />
        <result property="content" column="content" />
        <result property="uploadDate" column="uploadDate" />
    </resultMap>
    <resultMap id="imageResult" type="imageDTO">
        <result property="postId" column="postId" />
        <result property="imageNo" column="imageNo" />
        <result property="fileName" column="fileName" />
        <result property="filePath" column="filePath" />
    </resultMap>

    <!-- 게시물 추가(이미지는 따로 저장) -->
    <insert id="addPost" parameterType="postDTO">
        <![CDATA[
                INSERT INTO sns_content VALUES (postId_seq.nextval, #{content}, #{userId}, sysdate)
                ]]>
    </insert>

    <!-- 이미지 추가 -->
    <insert id="addImage" parameterType="java.util.Map">
        <foreach item="item" collection="list" open="insert all" separator=" " close="select * from dual">
            into sns_image values(#{item.postId}, #{item.imageNo}, #{item.fileName}, #{item.filePath})
        </foreach>
    </insert>

    <!-- 게시물 번호 -->
    <select id="selectPostId" resultType="int">
        <![CDATA[ select case when max(postid) is null then 1 else max(postId) + 1 end from sns_content]]>
    </select>

    <!-- 이미지 번호 -->
    <select id="selectImageNo" resultType="int">
        <![CDATA[ select nvl(max(imageNo),0) from sns_image]]>
    </select>
</mapper>
